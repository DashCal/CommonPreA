<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>瑞幸咖啡 - TakeOutCode</title>
    <style>
        img {
            width: 100vw;
        }

        :root {
            --background-color: #f5f5f5;
            --text-color: #656565;
            --dtext-color: #353535;
            --code-font-color: #343434;
            --code-instruction-font-color: #868690;

            --orig-width: 1440;
            --orig-height: 900;
            --orig-statebar-height: 140;
            --orig-code-section-height: 170;
            --orig-code-font-height: 85;
            --orig-code-instruction-font-height: 50;
            --orig-code-section-paddingtop-height: 74;
            --orig-code-section-paddingbtm-height: 50;

            --orig-qrcode-size: 680;
            --orig-qrcode-instruction-height: 00;



            --state-bar-height: calc(100vw * var(--orig-statebar-height)/ var(--orig-width));


            --code-font-size: 31px;
            --code-instruction-font-size: 14px;

            --code-section-height: calc(100vw * var(--orig-code-section-height)/ var(--orig-width));
            --code-font-section-height: calc(100vw * var(--orig-code-font-height)/ var(--orig-width));
            --code-instruction-font-section-height: calc(100vw * var(--orig-code-instruction-font-height)/ var(--orig-width));
            --code-section-paddingtop-height: calc(100vw * var(--orig-code-section-paddingtop-height)/ var(--orig-width));
            --code-section-paddingbtm-height: calc(100vw * var(--orig-code-section-paddingbtm-height)/ var(--orig-width));

            --qrcode-size: calc(100vw * var(--orig-qrcode-size)/ var(--orig-width));
            --qrcode-instruction-size: 0;
        }

        body {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            height: fit-content;
            min-height: 400px;
            width: 100%;
            min-width: 100%;
            max-width: 100%;
            background-color: var(--background-color);
            display: flex;
            overflow-x: hidden;
            flex-direction: column;
            flex-wrap: nowrap;
            justify-content: flex-start;
            align-content: center;

            -webkit-user-select: none;
            user-select: none;
        }

        #loader {
            height: 100%;
            width: 100%;
            -webkit-backdrop-filter: blur(5px);
            backdrop-filter: blur(5px);
            position: fixed;
            display: flex;
            flex-wrap: nowrap;
            flex-direction: column;
            align-content: center;
            justify-content: center;
            align-items: center;
        }

        .container {
            height: 100%;
            width: 100%;
            display: flex;
            flex-wrap: nowrap;
            flex-direction: column;
            align-content: center;
            justify-content: center;
            align-items: center;
        }

        .takeoutcode-container {
            height: 100%;
            width: 100%;
            display: flex;
            flex-direction: column;
            flex-wrap: nowrap;
            align-content: center;
            justify-content: flex-start;
            align-items: center;
        }

        .takeoutcode-container {
            .state-bar {
                height: var(--state-bar-height);
                width: 100%;
            }

            .bgimg-stack {
                width: 100%;
                display: block;
            }

            .tk-code {
                height: var(--code-section-height);
                width: 100%;
                padding-top: var(--code-section-paddingtop-height);
                padding-bottom: var(--code-section-paddingbtm-height);

                display: flex;
                flex-direction: column;
                flex-wrap: nowrap;
                align-content: center;
                justify-content: space-between;
                align-items: center;


                .thecode {
                    /* border: gray 2px solid; */
                    height: var(--code-font-section-height);
                    width: 100%;
                    display: flex;
                    flex-direction: column;
                    flex-wrap: nowrap;
                    align-content: center;
                    justify-content: center;
                    align-items: center;

                    input {
                        background: none;
                        border: none;
                        text-align: center;
                    }

                    #THETKCODE {
                        font-size: var(--code-font-size);
                        letter-spacing: -.5px;
                        font-weight: medium;
                        font-weight: 500;
                        color: var(--code-font-color);
                    }
                }

                .thecode-instruction {
                    height: var(--code-instruction-font-section-height);
                    width: 100%;
                    text-align: center;
                    line-height: var(--code-instruction-font-size);
                    font-size: var(--code-instruction-font-size);
                    letter-spacing: .2px;
                    font-weight: medium;
                    font-weight: 400;
                    color: var(--code-instruction-font-color);
                }
            }

            .tk-qrcode {
                height: var(--qrcode-size);
                width: 100%;
                padding-bottom: 2px;

                display: flex;
                flex-direction: row;
                flex-wrap: nowrap;
                align-content: center;
                justify-content: center;
                align-items: center;


                .qrcode-canvas-container {
                    height: 100%;
                    width: var(--qrcode-size);
                    border: white 2px solid;

                    .qrcode-canvas {
                        height: 100%;
                        width: 100%;
                        image-rendering: pixelated;
                    }
                }
            }

            .tk-qrcode-instruction {
                height: var(--qrcode-instruction-size);
                width: 100%;

                display: flex;
                flex-direction: row;
                flex-wrap: nowrap;
                align-content: center;
                justify-content: center;
                align-items: center;
            }

            .tk-other {
                width: 100%;
            }
        }
    </style>
    <!-- <link rel="stylesheet" href="style.css"> -->
</head>

<body>
    <div class="container">
        <div id="loader">
            <span class="loader-text">正在加载...</span>
        </div>
        <div class="takeoutcode-container">
            <div class="state-bar">
            </div>
            <img class="bgimg-stack" src="./material/01.png" alt="">
            <div class="tk-code">
                <div class="thecode">
                    <input type="number" id="THETKCODE" value="985" placeholder="取餐码"></input>
                </div>
                <div class="thecode-instruction">取餐码</div>
            </div>
            <div class="tk-qrcode">
                <div id="canvas-container" class="qrcode-canvas-container">
                    <canvas class="qrcode-canvas" id="qrcode-canvas"></canvas>
                </div>
                <input type="file" id="file-input" accept="image/*" class="hidden" style="display: none">
            </div>
            <!-- <div class="tk-qrcode-instruction">
                <span>请扫码取餐</span>
            </div> -->
            <div class="tk-other">
                <img class="bgimg-stack" src="./material/03.png" alt="">
            </div>
        </div>
    </div>
    <script>
        window.onload = function () {

            let loader = document.getElementById("loader");
            setTimeout(function () {
                if (loader)
                    loader.style.display = "none";
            }, 100);

            let canvas = document.getElementById('qrcode-canvas');
            let ctx = canvas.getContext('2d');
            let container = document.getElementById('canvas-container');
            let fileInput = document.getElementById('file-input');
            // let uploadBtn = document.getElementById('upload-btn');
            // let resetBtn = document.getElementById('reset-btn');
            // let status = document.getElementById('status');

            // 初始化Canvas
            clearCanvas();

            // 双击Canvas事件
            canvas.addEventListener('dblclick', () => fileInput.click());

            // // 上传按钮事件
            // uploadBtn.addEventListener('click', () => fileInput.click());

            // // 重置按钮事件
            // resetBtn.addEventListener('click', clearCanvas);

            // 文件选择事件
            fileInput.addEventListener('change', (e) => {
                if (e.target.files[0]) handleImageUpload(e.target.files[0]);
            });

            // 拖拽事件处理
            container.addEventListener('dragover', (e) => {
                e.preventDefault();
                container.classList.add('drag-over');
            });

            container.addEventListener('dragleave', () => {
                container.classList.remove('drag-over');
            });

            container.addEventListener('drop', (e) => {
                e.preventDefault();
                container.classList.remove('drag-over');
                if (e.dataTransfer.files[0]) handleImageUpload(e.dataTransfer.files[0]);
            });

            // 处理图片上传
            function handleImageUpload(file) {
                if (!file.type.match('image.*')) {
                    // status.textContent = '错误：请选择图片文件！';
                    return;
                }

                let reader = new FileReader();
                reader.onload = (e) => loadImage(e.target.result, file.name);
                reader.readAsDataURL(file);
            }

            // 加载图片并绘制
            function loadImage(src, filename = "图片") {
                let img = new Image();
                img.onload = () => {
                    ctx.clearRect(0, 0, canvas.width, canvas.height);
                    ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
                    // status.textContent = `已加载: ${filename}`;
                };
                img.src = src;
            }

            // 清空Canvas
            function clearCanvas() {
                ctx.fillStyle = '#f5f5f5';
                ctx.fillRect(0, 0, canvas.width, canvas.height);

                ctx.fillStyle = '#aaa';
                ctx.font = '12px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('双击或拖放图片到此处', canvas.width / 2, canvas.height / 2);

                // status.textContent = '等待上传图片...';
            }
        }
    </script>
    <script type="javascript" src="script.js"></script>
</body>

</html>